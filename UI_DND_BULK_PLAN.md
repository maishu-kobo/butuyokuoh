# ドラッグ&ドロップ ・ 一括操作 実装計画

## 6. ドラッグ&ドロップで優先度変更

### 概要
- リスト上でアイテムをドラッグして並び替え
- ドロップ時に優先度を更新
- ソートが「優先度順」の時のみ有効

### ライブラリ選定
- **@dnd-kit/core** - React用の軽量なD&Dライブラリ
  - モダンでアクティブにメンテナンスされている
  - タッチデバイス対応
  - アクセシビリティ対応

### 実装ステップ
- [ ] @dnd-kit/core, @dnd-kit/sortable インストール
- [ ] page.tsxに DndContext, SortableContext を追加
- [ ] ItemCardを useSortable でラップ
- [ ] ドラッグハンドルを追加（アイコン）
- [ ] onDragEndで優先度を更新するAPI呼び出し
- [ ] 優先度順以外のソート時はドラッグ無効化

### API
- `PATCH /api/items/:id` - 既存のエンドポイントでpriorityを更新可能

### UIイメージ
```
≡ [Drag Handle]  MacBook Air M3    ¥164,800
≡ [Drag Handle]  Sony WF-1000XM5   ¥36,520
≡ [Drag Handle]  AirPods Pro 2     ¥39,800
```

---

## 7. 一括操作

### 概要
- チェックボックスで複数アイテムを選択
- 一括で: 削除 / カテゴリ変更 / 比較グループ追加 / 購入済みにする

### 実装ステップ
- [ ] page.tsxに selectionMode state 追加
- [ ] page.tsxに selectedItems: Set<number> state 追加
- [ ] 「選択モード」ボタンをアクションバーに追加
- [ ] ItemCardにチェックボックス表示（selectionMode時）
- [ ] 一括操作バーを画面下部に固定表示
- [ ] 一括削除API呼び出し（ループまたは新規API）
- [ ] 一括カテゴリ変更
- [ ] 一括グループ追加
- [ ] 一括購入済み

### UIイメージ
```
アクションバー:
[選択] [インポート] [全て更新]

選択モード時:
[全選択] [選択解除] [3件選択中]

アイテムカード:
[☐] MacBook Air M3    ¥164,800
[☑] Sony WF-1000XM5   ¥36,520  ← 選択済
[☑] AirPods Pro 2     ¥39,800  ← 選択済

下部固定バー（選択時のみ表示）:
[2件選択中] [削除] [カテゴリ変更 ▼] [グループ追加 ▼] [購入済みにする]
```

---

## 実装順序

1. **ドラッグ&ドロップ** (6)
   - 先に実装（一括操作よりシンプル）
   - ライブラリインストールが必要

2. **一括操作** (7)
   - D&Dとの共存を考慮
   - 選択モード中はD&D無効化

---

## 進捗

### 6. ドラッグ&ドロップ ✅ 完了
- [x] @dnd-kit/core, @dnd-kit/sortable インストール
- [x] SortableItemCardコンポーネント作成
- [x] page.tsxにDndContext/SortableContext追加
- [x] ドラッグハンドル（GripVerticalアイコン）
- [x] 優先度順以外のソート時はドラッグ無効

### 7. 一括操作 ✅ 完了
- [x] selectionMode / selectedItems state追加
- [x] 「選択」ボタンで選択モード切り替え
- [x] カードにチェックボックス表示
- [x] 全選択 / 選択解除 / キャンセル
- [x] 下部に一括操作バー
- [x] 一括削除
- [x] 一括カテゴリ変更
- [x] 一括グループ変更
- [x] 一括購入済み
